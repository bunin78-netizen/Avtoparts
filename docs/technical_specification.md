# Техническое задание: AutoParts Shop

## 1. Общая информация

### 1.1 Название проекта
**AutoParts Shop** — интернет-магазин автозапчастей с интеграциями платежных систем, мессенджеров и поставщиков.

### 1.2 Цель проекта
Создание полнофункционального интернет-магазина автозапчастей с:
- автоматическим импортом товаров от поставщиков через API;
- интеграцией мессенджеров (Telegram, Viber) для уведомлений и заказов;
- интеграцией платежных систем (Monobank, PrivatBank);
- интеграцией службы доставки (Новая Почта);
- административной панелью для управления.

### 1.3 Целевая аудитория
- B2C клиенты (владельцы автомобилей);
- B2B клиенты (автосервисы, СТО);
- регион: Украина.

## 2. Технический стек

### 2.1 Backend
- Python 3.11+
- FastAPI 0.104+
- SQLAlchemy 2.0+ (ORM)
- Alembic (миграции БД)
- PostgreSQL 15+ (основная БД)
- Redis 7+ (кэш, очереди)
- Celery 5+ (фоновые задачи)
- aiogram 3+ (Telegram бот)
- viberbot 1.0+ (Viber бот)
- aiohttp 3.9+ (асинхронные HTTP запросы)
- Pydantic 2.5+ (валидация данных)
- python-jose (JWT токены)
- passlib (хэширование паролей)

### 2.2 Frontend
- React 18+
- React Router 6+
- Ant Design 5+ (UI библиотека)
- Axios 1.6+ (HTTP клиент)
- React Query / SWR (кэширование данных)

### 2.3 DevOps
- Docker 20.10+
- Docker Compose 2.0+
- Nginx (reverse proxy)
- Let's Encrypt (SSL сертификаты)
- GitHub Actions / GitLab CI (CI/CD)

### 2.4 Мониторинг и логирование
- Prometheus (метрики)
- Grafana (визуализация)
- ELK Stack или Loki (логи)
- Sentry (отслеживание ошибок)

## 3. Архитектура системы

### 3.1 Общая схема
- Frontend (React + Ant Design + Axios + Router)
- Nginx как reverse proxy
- Несколько инстансов FastAPI
- PostgreSQL, Redis, Celery Worker/Beat
- Внешние интеграции: Telegram API, Viber API, Suppliers API, Monobank API, PrivatBank API, Nova Poshta API

### 3.2 Структура базы данных
Ключевые сущности:
- `users`
- `suppliers`
- `categories`
- `products`
- `orders`
- `order_items`
- `order_status_history`
- `cart_items`
- `favorites`
- `reviews`
- `price_history`
- `search_queries`
- `settings`
- `promo_codes`
- `notifications`
- `integration_logs`

Дополнительно предусмотрены индексы по основным сценариям поиска, фильтрации и аналитики.

## 4. Функциональные требования

### 4.1 Пользовательская часть (Frontend)

#### 4.1.1 Главная страница
**Требования:**
- слайдер с акциями/новинками;
- популярные категории (grid 4x2);
- хиты продаж (карусель);
- блок «Как сделать заказ»;
- блок преимуществ;
- футер с контактами.

**Компоненты:**
- `HeroSlider`
- `CategoryGrid`
- `ProductCarousel`
- `HowToOrder`
- `Features`
- `Footer`

**API:**
- `GET /api/banners`
- `GET /api/categories/popular`
- `GET /api/products/bestsellers`

#### 4.1.2 Поиск товаров
**Требования:**
- поиск по артикулу (основной);
- опциональный фильтр по бренду;
- поиск у всех поставщиков;
- таблица результатов;
- сортировка: цена, наличие, поставщик;
- фильтры: цена, бренд, поставщик, наличие;
- пагинация.

**API:**
- `POST /api/products/search`

**Логика:**
1. Запрос ко всем активным поставщикам.
2. Агрегация результатов.
3. Применение наценки поставщика.
4. Дедупликация по `(артикул + бренд)`.
5. Сортировка по приоритету.

#### 4.1.3 Карточка товара
**Требования:**
- галерея изображений;
- название, артикул, бренд;
- текущая и старая цена;
- наличие и количество;
- характеристики (таблица);
- применимость;
- OE номера;
- похожие товары;
- отзывы;
- кнопки: «В корзину», «В избранное», «Купить в 1 клик».

**API:**
- `GET /api/products/:id`
- `POST /api/products/:id/reviews`
- `GET /api/products/:id/related`

#### 4.1.4 Корзина
**Требования:**
- таблица товаров;
- изменение количества;
- удаление;
- автосохранение в localStorage;
- расчет итогов;
- промокод;
- переход к оформлению.

**API:**
- `GET /api/cart`
- `POST /api/cart/items`
- `PUT /api/cart/items/:id`
- `DELETE /api/cart/items/:id`
- `POST /api/cart/apply-promo`

#### 4.1.5 Оформление заказа
Шаги:
1. Контактные данные.
2. Доставка.
3. Оплата.
4. Подтверждение.

**API:**
- `POST /api/orders`
- `GET /api/delivery/cities?search=`
- `GET /api/delivery/warehouses/:cityRef`
- `POST /api/promo-codes/validate`

#### 4.1.6 Личный кабинет
Разделы:
- профиль;
- мои заказы;
- избранное;
- адреса.

**API:**
- `GET /api/users/me`
- `PUT /api/users/me`
- `PUT /api/users/me/password`
- `GET /api/users/me/orders`
- `GET /api/users/me/favorites`
- `POST /api/users/link-telegram`
- `POST /api/users/link-viber`

### 4.2 Административная панель
Разделы:
- Dashboard (метрики, графики, топ товаров, последние заказы);
- управление заказами;
- управление товарами;
- управление поставщиками;
- управление пользователями;
- настройки (общие, оплата, доставка, мессенджеры).

### 4.3 Backend API
Ключевые домены:
- аутентификация и авторизация;
- каталог и поиск товаров;
- корзина;
- заказы;
- платежи;
- доставка (Новая Почта).

### 4.4 Интеграция с поставщиками
- Базовый интерфейс `BaseSupplierAPI` с обязательными методами:
  - `search_products`
  - `get_product_details`
  - `check_availability`
  - `create_order`
  - `get_order_status`
- Пример конкретной реализации: `OmegaSupplierAPI`.
- Отдельный `SupplierSyncService` для синхронизации, поиска по поставщикам, дедупликации и применения наценки.

### 4.5 Интеграция мессенджеров
- Telegram-бот на `aiogram` с состояниями:
  - поиск запчастей;
  - корзина;
  - оформление заказа;
  - просмотр заказов.
- Предусмотрены сценарии регистрации, поиска, добавления в корзину и оформления заказа.

### 4.6 Celery задачи
Периодические задачи:
- синхронизация поставщиков (ежечасно);
- проверка статусов платежей (каждые 5 минут);
- обновление статусов доставки (каждые 30 минут);
- очистка старых корзин;
- напоминания о брошенных корзинах;
- обновление статистики товаров;
- резервное копирование БД.

## 5. Итог
Документ описывает полную архитектуру, функциональные требования, API-контракты и интеграционные сценарии для реализации интернет-магазина автозапчастей AutoParts Shop под рынок Украины.
